---
title: "Exploring PubMed Abstracts with Spark"
author: "Sean D McAtee"
date: '2021-03-07'
categories: []
tags: []
Description: TF-IDF of Abstract text to explore Journal titles
Tags: []
Categories: []
DisableComments: no
slug: exploring-pubmed-abstracts-with-spark
---



<hr />
<div id="under-development" class="section level1">
<h1><em>UNDER DEVELOPMENT</em></h1>
<hr />
<p></br></p>
<div id="motivation" class="section level2">
<h2>Motivation:</h2>
<p>Academic literature information extraction is a fascinating subject. There is a big push to automate information extraction. This project is focused on how a whole journal corpus may be compared to another using their abstract text content. Journal corpus similarity could be a useful feature to use during other information extraction tasks. True subject matter is difficult to determine based on a cursory glance at the title and a few published articles. Additionally, a journal’s or whole field’s range of topics could shift over time because of new tools, job responsibilities, and knowledge (eg Radiology and Genetics are radically different than in 1900, their academic journals likely reflect these changes).</p>
<p>Therefore, it could be useful to classify journals based on the text that they publish. PubMed Baseline includes article abstracts as well as metadata like Grant Agency, University Affiliation, Date, and Authors. These fields allow the linkage of other data sources.</p>
<p></br></br></p>
</div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>brief overview hitting subtitles and key words</p>
<p></br></br></p>
</div>
<div id="datasets" class="section level2">
<h2>Datasets</h2>
<p>This analysis uses PubMed data to compare subgroups of journals. The database is called <a href="ftp://ftp.ncbi.nlm.nih.gov/pubmed/baseline">PubMed Baseline</a>. I used a subset of the PubMed Baseline. Arguably, there would be a shift in popularity and word usage among journal topics which could take extra processing to normalize. It was simpler to take a snapshot of journals and sidestep this issue for now.</p>
<p></br></br></p>
<div id="xml-parsing" class="section level3">
<h3>XML Parsing</h3>
<p>PubMed Baseline data is stored in many zipped XML files. Each XML file contains data from many articles.</p>
<p>I downloaded and decompressed a selection of the Baseline files with a typical Bash script.</p>
<pre><code>#!/bin/bash

## LOCALLY

# Download files from ftp://ftp.ncbi.nlm.nih.gov/pubmed/baseline/
wget -P ~/tmp/ ftp://ftp.ncbi.nlm.nih.gov/pubmed/baseline/pubmed20n1*  # define file set

# For each file downloaded check md5
md5sum --check ~/tmp/pubmed*.xml.gz.md5

# Unzip .gz files
gzip -d ~/tmp/pubmed*.gz

# Remove md5 files
rm -f ~/tmp/pubmed*.xml.gz.md5

# Move files to HDFS
#hdfs dfs -put *.xml /user/sm9553/project</code></pre>
<p></br></p>
<p>The <a href="https://github.com/databricks/spark-xml">spark-xml</a> package from <a href="https://databricks.com/">Databricks</a>, primarily developed by <a href="https://github.com/HyukjinKwon">Hyukjin Kwon</a>, was used to parse the XML files into a Spark DataFrame.</p>
<pre><code>/** Parse XML to DataFrame */
val pubmed =
  sqlContext.read.format(
    &quot;org.apache.spark.sql.xml&quot;
    ).option(&quot;rootTag&quot;, &quot;PubmedArticle&quot;
      ).load(
        &quot;tmp/PubMed.xml&quot;
        )</code></pre>
<p></br></p>
<p>These steps will become a serious bottleneck if many XML files need to be parsed into a Spark format. To be a true map-reduce workflow, this step as well as the XML parsing should be distributed. In another life I ought to <code>wget</code>, parse xml files, and extract the few necessary fields in the map phase, then reduce/join everything into a single Spark DataFrame for intermediate storage on HDFS.</p>
<p></br></br></p>
</div>
<div id="lemma-array-generation" class="section level3">
<h3>Lemma Array Generation</h3>
<p>The <a href="https://stanfordnlp.github.io/CoreNLP/">Stanford CoreNLP</a> package was used to break down <code>AbstractText</code> strings into lemmas. Part of speech tags were generated for each lemma to filter out uninformative elements, such as coordinating conjunctions and prepositions. At this stage there are 5591 unique JournalTitles in the corpus and 112,405 unique lemmas across all JournalTitles.</p>
<pre><code>/** extract abstracts and extra info */
var abstractsEtc =
  pubmed.select(
    $&quot;MedlineCitation.PMID&quot;,
    $&quot;MedlineCitation.Article.Abstract.AbstractText&quot;,
    $&quot;MedlineCitation.Article.Journal.Title&quot;.as(&#39;journalTitle)
    ).withColumn(
      &quot;AbstractText&quot;, concat_ws(&quot; &quot;, col(&quot;AbstractText&quot;))
      )
      
/** explode sentences */
var lemmas =
  abstractsEtc.select(
    &#39;PMID, &#39;journalTitle,
    explode(ssplit(&#39;AbstractText)).as(&#39;sentence)
    ).select(
      &#39;PMID, &#39;journalTitle,
      explode(lemma(&#39;sentence)).as(&quot;lemma&quot;)
      ).withColumn(&quot;pos&quot;, pos(&#39;lemma) )

/** filter out useless pos-types, make a udf */
val filtLemmas =
  lemmas.filter(
    &#39;pos(0).rlike(&quot;[^(DT)(CD)(CC)(IN)(LS)(SYM)(TO)(\\.)(\\,)(\\;)(\\:)]&quot;)
    )

/** group by */
var journalLemmas =
  filtLemmas.select(
    &#39;journalTitle,
    &#39;lemma
      ).groupBy(&quot;journalTitle&quot;).agg(collect_list(&quot;lemma&quot;) as &quot;lemma&quot;)</code></pre>
<p></br></p>
<div id="a-snapshot-of-this-spark-dataframe-from-the-terminal" class="section level4">
<h4>A snapshot of this Spark DataFrame from the terminal</h4>
<p><img src="/static/images/post/2021-03-07-exploring-pubmed-abstracts-with-spark/posLemma.jpg" /></p>
</div>
</div>
<div id="tf-idf-features" class="section level3">
<h3>TF-IDF Features</h3>
<p>Lemma arrays were converted to TF-IDF feature vectors in the following way. The <a href="https://spark.apache.org/docs/2.2.0/api/java/org/apache/spark/ml/package-summary.html">Spark ML</a> package was used to hash lemmas. The number of features for the hash function was set to 2^17, above 5591 to avoid collisions and set as a power of 2 to increase calculation speed. Spark ML was also used to calculate IDF for the hashed lemma vectors. IDF values were rescaled to generate TF-IDF values.</p>
<pre><code>var numFeatures = 131072

val hashingTF =
  new HashingTF(
    ).setInputCol(&quot;lemma&quot;).setOutputCol(&quot;rawFeatures&quot;).setNumFeatures(numFeatures)

val journalhashedLemmas = hashingTF.transform(journalLemmas)
val idf = new IDF().setInputCol(&quot;rawFeatures&quot;).setOutputCol(&quot;features&quot;)
val journalIdfModel = idf.fit(journalhashedLemmas)

val journalrescaledData = journalIdfModel.transform(journalhashedLemmas)

val journalDense = 
  journalrescaledData.select(
    &quot;journalTitle&quot;, &quot;features&quot;).withColumn(&quot;features&quot;, asDense($&quot;features&quot;))</code></pre>
<p></br></p>
<div id="a-snapshot-of-this-spark-dataframe-from-the-terminal-1" class="section level4">
<h4>A snapshot of this Spark DataFrame from the terminal</h4>
<p><img src="static/images/post/2021-03-07-exploring-pubmed-abstracts-with-spark/featureVec.jpg" /></p>
<p></br></br></p>
</div>
</div>
<div id="subgroup-comparison" class="section level3">
<h3>Subgroup Comparison</h3>
<p>I chose subgroups to be highly specific and not even remotely selective – if the journal title contains the word “Diabetes”, “Asthma”, or “HIV”. The subgroups were selected using simple RegEx patterns.</p>
<pre><code>val diabetes_journalDense =
  journalDense.filter(
    &#39;journalTitle.rlike(&quot;(\\b[Dd]iabet)&quot;)).select(
      &#39;journalTitle.alias(&quot;journalTitle_subset&quot;), &#39;features.alias(&quot;features_subset&quot;))

val asthma_journalDense =
  journalDense.filter(
    &#39;journalTitle.rlike(&quot;(\\b[Aa]sthma)&quot;)).select(
      &#39;journalTitle.alias(&quot;journalTitle_subset&quot;), &#39;features.alias(&quot;features_subset&quot;))

val hiv_journalDense =
  journalDense.filter(
    &#39;journalTitle.rlike(&quot;(\\b[Hh][Ii][Vv])&quot;)).select(
      &#39;journalTitle.alias(&quot;journalTitle_subset&quot;), &#39;features.alias(&quot;features_subset&quot;))</code></pre>
<p></br></p>
<p>Here is a short exploration of the three groups.</p>
<p></br></p>
<div id="the-number-of-journals-in-each-group" class="section level4">
<h4>The number of journals in each group:</h4>
<pre class="r"><code>list(
  distinct_all = n_distinct(asthma$journal_x),
  distinct_asthma = n_distinct(asthma$journal_asthma),
  distinct_diabetes = n_distinct(diabetes$journal_diabetes),
  distinct_hiv = n_distinct(hiv$journal_hiv)
  ) %&gt;% as.data.frame( row.names = &quot;n_journals&quot;)</code></pre>
<pre><code>##            distinct_all distinct_asthma distinct_diabetes distinct_hiv
## n_journals         5591               5                40            8</code></pre>
<p></br></p>
</div>
<div id="three-of-the-journal-titles-from-each-group" class="section level4">
<h4>Three of the journal titles from each group:</h4>
<pre class="r"><code>asthma$journal_asthma %&gt;% unique() %&gt;% head(3)</code></pre>
<pre><code>## [1] &quot;Journal of asthma and allergy&quot;                                                                                         
## [2] &quot;The Journal of asthma : official journal of the Association for the Care of Asthma&quot;                                    
## [3] &quot;Annals of allergy, asthma &amp; immunology : official publication of the American College of Allergy, Asthma, &amp; Immunology&quot;</code></pre>
<pre class="r"><code>diabetes$journal_diabetes %&gt;% unique() %&gt;% head(3)</code></pre>
<pre><code>## [1] &quot;Diabetology &amp; metabolic syndrome&quot; &quot;Journal of diabetes research&quot;    
## [3] &quot;JMIR diabetes&quot;</code></pre>
<pre class="r"><code>hiv$journal_hiv %&gt;% unique() %&gt;% head(3)</code></pre>
<pre><code>## [1] &quot;Southern African journal of HIV medicine&quot;
## [2] &quot;Current HIV research&quot;                    
## [3] &quot;Current HIV/AIDS reports&quot;</code></pre>
<p></br></br></p>
</div>
</div>
</div>
<div id="exploring-the-results" class="section level2">
<h2>Exploring the results</h2>
<p></br></br></p>
<div id="cosine-similarity" class="section level3">
<h3>Cosine similarity</h3>
<p>Each group was passed to the pairwise cosine similarity user-defined-function (UDF) to be compared against the whole set. I used the UDF from <a href="https://stackoverflow.com/a/62140182">this stack answer</a></p>
<p>A table of cosine similarities for these three groups vs the whole set was exported to my local environment to analyze in R.</p>
<pre><code>val cosSimilarity = udf { (x: Vector, y: Vector) =&gt;
    val v1 = x.toArray
    val v2 = y.toArray
    val l1 = scala.math.sqrt(v1.map(x =&gt; x*x).sum)
    val l2 = scala.math.sqrt(v2.map(x =&gt; x*x).sum)
    val scalar = v1.zip(v2).map(p =&gt; p._1*p._2).sum
    val cosineSim = scalar/(l1*l2)
    &quot;%.6f&quot;.format(cosineSim).toDouble
}

val joinedDf =
  journalDense.join(diabetes_journalDense, &#39;journalTitle =!= &#39;journalTitle_subset)
  
val cosSimDf =
  joinedDf.withColumn(&quot;cosine_sim&quot;, cosSimilarity(&#39;features_subset, &#39;features)).select(
    &#39;journalTitle, &#39;journalTitle_subset, &#39;cosine_sim)</code></pre>
<p></br></p>
<div id="highest-cosine-similarity-scores-for-each-group" class="section level4">
<h4>Highest cosine similarity scores for each group:</h4>
<p>These are the two highest cosine similarity pairs for each journal in each group.</p>
<pre class="r"><code>asthma_top_sim &lt;- unique(asthma$journal_asthma[!(asthma$journal_x %in% asthma$journal_asthma)]) %&gt;% 
  purrr::map_dfr(
    ~ asthma[!(asthma$journal_x %in% asthma$journal_asthma),] %&gt;% 
    dplyr::filter(journal_asthma == .x ) %&gt;%
    dplyr::arrange(desc(cosine_similarity)) %&gt;%
    head(2)
  )
asthma_top_sim</code></pre>
<pre><code>## # A tibble: 10 x 3
##    journal_x                 journal_asthma                     cosine_similari~
##    &lt;chr&gt;                     &lt;chr&gt;                                         &lt;dbl&gt;
##  1 Allergy                   Journal of asthma and allergy                 0.213
##  2 NPJ primary care respira~ Journal of asthma and allergy                 0.175
##  3 Allergy                   The Journal of asthma : official ~            0.337
##  4 The journal of allergy a~ The Journal of asthma : official ~            0.287
##  5 Pediatric clinics of Nor~ Annals of allergy, asthma &amp; immun~            0.208
##  6 International archives o~ Annals of allergy, asthma &amp; immun~            0.208
##  7 The European respiratory~ Allergy, asthma, and clinical imm~            0.202
##  8 Respiratory research      Allergy, asthma, and clinical imm~            0.198
##  9 Allergy                   Asthma research and practice                  0.207
## 10 The journal of allergy a~ Asthma research and practice                  0.188</code></pre>
<p></br></p>
<pre class="r"><code>diabetes_top_sim</code></pre>
<pre><code>## # A tibble: 80 x 3
##    journal_x                 journal_diabetes                   cosine_similari~
##    &lt;chr&gt;                     &lt;chr&gt;                                         &lt;dbl&gt;
##  1 Nutrients                 Diabetology &amp; metabolic syndrome              0.270
##  2 PloS one                  Diabetology &amp; metabolic syndrome              0.268
##  3 Pediatric dimensions      Journal of diabetes research                  0.229
##  4 Nature metabolism         Journal of diabetes research                  0.219
##  5 Monographs of the Societ~ JMIR diabetes                                 0.237
##  6 JMIR mHealth and uHealth  JMIR diabetes                                 0.236
##  7 Progress in cardiovascul~ Diabetes therapy : research, trea~            0.347
##  8 BMJ (Clinical research e~ Diabetes therapy : research, trea~            0.220
##  9 The Journal of endocrino~ Diabetes                                      0.226
## 10 Frontiers in endocrinolo~ Diabetes                                      0.209
## # ... with 70 more rows</code></pre>
<p></br></p>
<pre class="r"><code>hiv_top_sim</code></pre>
<pre><code>## # A tibble: 16 x 3
##    journal_x                        journal_hiv                 cosine_similari~
##    &lt;chr&gt;                            &lt;chr&gt;                                  &lt;dbl&gt;
##  1 AIDS research and therapy        Southern African journal o~            0.210
##  2 Journal of the International AI~ Southern African journal o~            0.205
##  3 Natural product communications   Current HIV research                   0.172
##  4 Journal of life sciences (Westl~ Current HIV research                   0.142
##  5 AIDS care                        Current HIV/AIDS reports               0.360
##  6 AIDS and behavior                Current HIV/AIDS reports               0.358
##  7 AIDS and behavior                Current opinion in HIV and~            0.437
##  8 AIDS care                        Current opinion in HIV and~            0.412
##  9 AIDS and behavior                Journal of HIV/AIDS &amp; soci~            0.288
## 10 AIDS care                        Journal of HIV/AIDS &amp; soci~            0.277
## 11 AIDS care                        HIV/AIDS (Auckland, N.Z.)              0.267
## 12 AIDS and behavior                HIV/AIDS (Auckland, N.Z.)              0.266
## 13 AIDS and behavior                HIV medicine                           0.380
## 14 Journal of the International AI~ HIV medicine                           0.377
## 15 The lancet. Diabetes &amp; endocrin~ The lancet. HIV                        0.726
## 16 BJS open                         The lancet. HIV                        0.675</code></pre>
<p>Note how most top cosine similarities are in the range of 0.1 to 0.3. These are rather low values, so it might be useful to preprocess this data in a way that amplifies similarity.</p>
<p></br></br></p>
</div>
</div>
<div id="similar-journals-by-group" class="section level3">
<h3>Similar journals by group</h3>
<p>These are the top percentiles of cosines for each group. I selected the top 97.5%-ile for Diabetes and HIV, while lowering the percentile to 75% for the Asthma group to get a similar length output.</p>
<pre class="r"><code>ingroup_asthma_cossim &lt;-
  asthma$cosine_similarity[asthma$journal_x %in% asthma$journal_asthma]

asthma$journal_x[asthma$cosine_similarity &gt;
                   quantile(ingroup_asthma_cossim, probs = 0.75) &amp;
                 !(asthma$journal_x %in% asthma$journal_asthma)]</code></pre>
<pre><code>## [1] &quot;The European respiratory journal&quot;                           
## [2] &quot;Pediatric pulmonology&quot;                                      
## [3] &quot;Canadian respiratory journal&quot;                               
## [4] &quot;Expert review of respiratory medicine&quot;                      
## [5] &quot;Lung India : official organ of Indian Chest Society&quot;        
## [6] &quot;Zhonghua nei ke za zhi&quot;                                     
## [7] &quot;Pediatric clinics of North America&quot;                         
## [8] &quot;The journal of allergy and clinical immunology. In practice&quot;
## [9] &quot;Allergy&quot;</code></pre>
<p></br></p>
<pre class="r"><code>ingroup_diabetes_cossim &lt;-
  diabetes$cosine_similarity[diabetes$journal_x %in% diabetes$journal_diabetes]

diabetes$journal_x[diabetes$cosine_similarity &gt;
                     quantile(ingroup_diabetes_cossim, probs = 0.975) &amp;
                   !(diabetes$journal_x %in% diabetes$journal_diabetes)]</code></pre>
<pre><code>##  [1] &quot;The British journal of dermatology&quot;           
##  [2] &quot;The Lancet. Respiratory medicine&quot;             
##  [3] &quot;Journal of nutritional science&quot;               
##  [4] &quot;Vox sanguinis&quot;                                
##  [5] &quot;Lancet (London, England)&quot;                     
##  [6] &quot;Public health nutrition&quot;                      
##  [7] &quot;PloS one&quot;                                     
##  [8] &quot;Journal of the American Heart Association&quot;    
##  [9] &quot;The Lancet. Global health&quot;                    
## [10] &quot;British journal of haematology&quot;               
## [11] &quot;Clinical physiology and functional imaging&quot;   
## [12] &quot;Nutrients&quot;                                    
## [13] &quot;Progress in cardiovascular diseases&quot;          
## [14] &quot;BJS open&quot;                                     
## [15] &quot;The Lancet. Infectious diseases&quot;              
## [16] &quot;The Lancet. Neurology&quot;                        
## [17] &quot;Journal of Taibah University Medical Sciences&quot;
## [18] &quot;The British journal of surgery&quot;               
## [19] &quot;The Lancet. Child &amp; adolescent health&quot;        
## [20] &quot;The Lancet. Oncology&quot;                         
## [21] &quot;The Lancet. Planetary health&quot;                 
## [22] &quot;The Lancet. Haematology&quot;                      
## [23] &quot;The lancet. HIV&quot;</code></pre>
<p></br></p>
<pre class="r"><code>ingroup_hiv_cossim &lt;- hiv$cosine_similarity[hiv$journal_x %in% hiv$journal_hiv]
hiv$journal_x[hiv$cosine_similarity &gt; 
                quantile(ingroup_hiv_cossim, probs = 0.975) &amp;
              !(hiv$journal_x %in% hiv$journal_hiv)]</code></pre>
<pre><code>##  [1] &quot;Virologie (Montrouge, France)&quot;                         
##  [2] &quot;Vaccine: X&quot;                                            
##  [3] &quot;Current immunology reviews&quot;                            
##  [4] &quot;AIDS care&quot;                                             
##  [5] &quot;Virologie (Montrouge, France)&quot;                         
##  [6] &quot;AIDS care&quot;                                             
##  [7] &quot;The British journal of dermatology&quot;                    
##  [8] &quot;The Lancet. Respiratory medicine&quot;                      
##  [9] &quot;Journal of nutritional science&quot;                        
## [10] &quot;Vox sanguinis&quot;                                         
## [11] &quot;Lancet (London, England)&quot;                              
## [12] &quot;Public health nutrition&quot;                               
## [13] &quot;AIDS care&quot;                                             
## [14] &quot;Vaccine&quot;                                               
## [15] &quot;The Lancet. Global health&quot;                             
## [16] &quot;The lancet. Diabetes &amp; endocrinology&quot;                  
## [17] &quot;British journal of haematology&quot;                        
## [18] &quot;Clinical physiology and functional imaging&quot;            
## [19] &quot;Journal of the International AIDS Society&quot;             
## [20] &quot;AIDS and behavior&quot;                                     
## [21] &quot;Journal of the International AIDS Society&quot;             
## [22] &quot;AIDS and behavior&quot;                                     
## [23] &quot;AIDS and behavior&quot;                                     
## [24] &quot;Journal of the International AIDS Society&quot;             
## [25] &quot;BJS open&quot;                                              
## [26] &quot;The Lancet. Infectious diseases&quot;                       
## [27] &quot;AIDS and behavior&quot;                                     
## [28] &quot;The Lancet. Neurology&quot;                                 
## [29] &quot;AIDS (London, England)&quot;                                
## [30] &quot;AIDS (London, England)&quot;                                
## [31] &quot;AIDS (London, England)&quot;                                
## [32] &quot;The British journal of surgery&quot;                        
## [33] &quot;The Lancet. Child &amp; adolescent health&quot;                 
## [34] &quot;The Lancet. Oncology&quot;                                  
## [35] &quot;The Lancet. Planetary health&quot;                          
## [36] &quot;AIDS research and human retroviruses&quot;                  
## [37] &quot;Journal of acquired immune deficiency syndromes (1999)&quot;
## [38] &quot;AIDS research and human retroviruses&quot;                  
## [39] &quot;AIDS research and human retroviruses&quot;                  
## [40] &quot;The Lancet. Haematology&quot;                               
## [41] &quot;AIDS research and therapy&quot;                             
## [42] &quot;AIDS research and therapy&quot;</code></pre>
<p></br></p>
<p>Interestingly the HIV group has more similar journals than the Diabetes group. This could be mostly because I excluded “AIDS” in the RegEx pattern to select the group.</p>
<p></br></br></p>
</div>
<div id="quantile-comparisons" class="section level3">
<h3>Quantile Comparisons</h3>
<p>The final analysis and visualization steps were completed in R. Each 10th quantile of cosine similarities were calculated for each group using <code>stats::quantile</code>. The distribution of cosine similarities in each set is concentrated towards 0 with long tails trailing towards 1. It is to be expected that most cosine similarities will be closer to 0 since most journals will be dissimilar to each group. A thin distribution tail contains the relatively few journals that are similar. Within group quantiles were also calculated to determine if the pattern matching technique yielded groups that were internally more similar than the whole corpus.</p>
<p></br></br></p>
<pre class="r"><code>density(diabetes$X3) %&gt;% 
     plot(main = &quot;All Journal&#39;s Similarity To &#39;Diabetes&#39; Subset&quot;, xlab = &quot;Cosine Similarity&quot;)
density(asthma$X3) %&gt;% 
  plot(breaks = 100, main = &quot;All Journal&#39;s Similarity To &#39;HIV&#39; Subset&quot;, xlab = &quot;Cosine Similarity&quot;)</code></pre>
<pre><code>## Warning in plot.window(...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in plot.xy(xy, type, ...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in axis(side = side, at = at, labels = labels, ...): &quot;breaks&quot; is not a
## graphical parameter

## Warning in axis(side = side, at = at, labels = labels, ...): &quot;breaks&quot; is not a
## graphical parameter</code></pre>
<pre><code>## Warning in box(...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in title(...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre class="r"><code>density(hiv$X3) %&gt;% 
  plot(breaks = 100, main = &quot;All Journal&#39;s Similarity To &#39;Asthma&#39; Subset&quot;, xlab = &quot;Cosine Similarity&quot;)</code></pre>
<pre><code>## Warning in plot.window(...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in plot.xy(xy, type, ...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in axis(side = side, at = at, labels = labels, ...): &quot;breaks&quot; is not a
## graphical parameter

## Warning in axis(side = side, at = at, labels = labels, ...): &quot;breaks&quot; is not a
## graphical parameter</code></pre>
<pre><code>## Warning in box(...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in title(...): &quot;breaks&quot; is not a graphical parameter</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="672" /><img src="index_files/figure-html/unnamed-chunk-14-2.png" width="672" /><img src="index_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<p></br></br></p>
<div id="within-group-similarity-quantiles" class="section level4">
<h4>Within Group Similarity Quantiles</h4>
<pre class="r"><code># get list of diabetes articles
diabetesArticleNames &lt;- unique(diabetes$X2)
asthmaArticleNames &lt;- unique(asthma$X2)
hivArticleNames &lt;- unique(hiv$X2)

# compare cosine similarity values in quantiles of each group
diabetes[(diabetes$X1 %in% diabetesArticleNames),]$X3 %&gt;% quantile(probs = seq(0, 1, 0.1))
asthma[(asthma$X1 %in% asthmaArticleNames),]$X3 %&gt;% quantile(probs = seq(0, 1, 0.1))
hiv[(hiv$X1 %in% hivArticleNames),]$X3 %&gt;% quantile(probs = seq(0, 1, 0.1))</code></pre>
<p></br></p>
<p>This code chunk produces the table:</p>
<p></br></p>
<table>
<thead>
<tr class="header">
<th>Subgroup</th>
<th align="right">10</th>
<th align="right">20</th>
<th align="right">30</th>
<th align="right">40</th>
<th align="right">50</th>
<th align="right">60</th>
<th align="right">70</th>
<th align="right">80</th>
<th align="right">90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Diabetes</td>
<td align="right">0.0115</td>
<td align="right">0.0358</td>
<td align="right">0.0565</td>
<td align="right">0.0838</td>
<td align="right">0.1074</td>
<td align="right">0.1402</td>
<td align="right">0.1715</td>
<td align="right">0.2033</td>
<td align="right">0.2548</td>
</tr>
<tr class="even">
<td>Asthma</td>
<td align="right">0.0253</td>
<td align="right">0.0286</td>
<td align="right">0.0373</td>
<td align="right">0.0896</td>
<td align="right">0.1358</td>
<td align="right">0.1669</td>
<td align="right">0.2097</td>
<td align="right">0.2627</td>
<td align="right">0.3244</td>
</tr>
<tr class="odd">
<td>HIV</td>
<td align="right">0.0245</td>
<td align="right">0.0454</td>
<td align="right">0.0814</td>
<td align="right">0.0922</td>
<td align="right">0.1255</td>
<td align="right">0.1597</td>
<td align="right">0.1742</td>
<td align="right">0.2013</td>
<td align="right">0.2405</td>
</tr>
</tbody>
</table>
<p></br></p>
<p>Characteristics of these deciles:</p>
<ul>
<li>all groups seem to be similar from 40% to 70%</li>
<li>asthma journals are more similar to eachother as a whole (down to lowest quantiles)</li>
<li>diabetes and hiv have similar low quantile patterns, a few outliers made longer tails</li>
<li>the highest top similarities are in diabetes, appearing at the 90% quantile</li>
<li>the lowest top similarities are in hiv with no big spike, rather a slow decline</li>
</ul>
<p></br></br></p>
</div>
</div>
<div id="estimated-difference-of-quantiles" class="section level3">
<h3>Estimated difference of quantiles</h3>
<p>The R package <a href="https://cran.r-project.org/web/packages/WRS2/WRS2.pdf">WRS2</a> was used to calculate quantile differences between each group. The function <code>qcomb</code> was run on each of the following pairs: Diabetes-Asthma, Diabetes-HIV, Asthma-HIV. The output values include estimated difference for each quantile, a standard p-value, and a p.crit value.</p>
<p>This final step uses the Harrell-Davis quantile estimator to get better info on tails. This estimator is a weighted average of all order statistics. The shift fx is then used to compare HD estimates to find confidence interval differences between quantiles.</p>
<pre class="r"><code># Average cosSim for all unique journal titles
# an equivalent chunk computes asthaAve and hivAve
diabetesAve &lt;- diabetes %&gt;%
  group_by(X1) %&gt;%
  summarise(journalTitle = X1[[1]], cosSim = mean(X3)) %&gt;%
  ungroup() %&gt;% 
  select(journalTitle, diabetesCosSim = cosSim)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>joinedTable &lt;- full_join(full_join(hivAve, diabetesAve, by = &quot;journalTitle&quot;),
                         asthmaAve,
                         by = &quot;journalTitle&quot;)

joinedTableLong &lt;- joinedTable %&gt;% 
                    pivot_longer(cols = c(&quot;hivCosSim&quot;, &quot;diabetesCosSim&quot;, &quot;asthmaCosSim&quot;),
                             names_to = &quot;JournalGroup&quot;,
                             values_to = &quot;CosineSimilarity&quot;
                             )

diabetes_asthma &lt;- WRS2::qcomhd(CosineSimilarity ~ JournalGroup,
                                data = filter(joinedTableLong, JournalGroup != &quot;hivCosSim&quot;),
                                q = seq(from = 0, to = 1, by = 0.1), nboot = 100)

diabetes_hiv &lt;- WRS2::qcomhd(CosineSimilarity ~ JournalGroup,
                             data = filter(joinedTableLong, JournalGroup != &quot;asthmaCosSim&quot;),
                             q = seq(from = 0, to = 1, by = 0.1), nboot = 100)

asthma_hiv &lt;- WRS2::qcomhd(CosineSimilarity ~ JournalGroup,
                           data = filter(joinedTableLong, JournalGroup != &quot;diabetesCosSim&quot;),
                           q = seq(from = 0, to = 1, by = 0.1), nboot = 100)


diabetes_asthma_diff &lt;- tibble(quantile = diabetes_asthma$partable$q,
                               estimatedDiff = diabetes_asthma$partable$`est1-est.2`,
                               criticalPVal = diabetes_asthma$partable$p.crit)

diabetes_hiv_diff &lt;- tibble(quantile = diabetes_hiv$partable$q,
                            estimatedDiff = diabetes_hiv$partable$`est1-est.2`,
                            criticalPVal = diabetes_hiv$partable$p.crit)

asthma_hiv_diff &lt;- tibble(quantile = asthma_hiv$partable$q,
                          estimatedDiff = asthma_hiv$partable$`est1-est.2`,
                          criticalPVal = asthma_hiv$partable$p.crit)</code></pre>
<div id="plots-of-group-pairwise-quantile-differences" class="section level4">
<h4>Plots of group pairwise quantile differences</h4>
<div class="figure">
<img src="&#39;C:/Users/seand/OneDrive/Documents/CS_Projects/WebDevel/Portfolio/static/images/post/2021-03-07-exploring-pubmed-abstracts-with-spark/QuantDiffDiabetesAsthma.jpg&#39;" alt="" />
<p class="caption">words</p>
</div>
<div class="figure">
<img src="C:/Users/seand/OneDrive/Documents/CS_Projects/WebDevel/Portfolio/static/images/post/2021-03-07-exploring-pubmed-abstracts-with-spark/QuantDiffDiabetesHIV.png" alt="" />
<p class="caption">hgsl</p>
</div>
<div class="figure">
<img src="~/static/images/post/2021-03-07-exploring-pubmed-abstracts-with-spark/quantDiffAsthmaHIV.png" alt="" />
<p class="caption">gshgwp</p>
</div>
<div class="figure">
<img src="~/Documents/CS_Projects/WebDevel/Portfolio/static/images/post/2021-03-07-exploring-pubmed-abstracts-with-spark/quantDiffAsthmaHIV.png" alt="" />
<p class="caption">pcivpc</p>
</div>
<p></br></p>
<p>Aside from the 0 percentile estimate, all standard p-values and p.crit values were below 0.05, while most were below 0.01. All pairwise comparisons show a high degree of similarity in the 40th and 60th percentile range.</p>
<p>The most stark difference is in the 80th quantile and above. Diabetes-Asthma and Diabetes-HIV are the most dissimilar in the upper quantiles. This indicates that the group Diabetes is more distinct
than the groups HIV and Asthma.</p>
<p></br></br></p>
</div>
</div>
</div>
<div id="conclusion-mistakes-next-steps.." class="section level2">
<h2>Conclusion, Mistakes, Next Steps..</h2>
<p>The workflow described in this paper can be customized to group vectors for any of the metadata
fields in PubMed. For example, grant agency, author affiliation, year, and MESH terms are all loaded
in the beginning of the workflow. They could easily be incorporated into an analysis.</p>
<p>Highly skewed distributions are difficult to characterize because most estimators focus on the maximum
area of a distribution. In the case of cosine similarity in a large corpus, the distribution tail will
contain the most useful information. This workflow, and other similar workflows, allow researchers
to gather information that might not be readily apparent with a standard statistical approach.</p>
<div id="next-steps" class="section level4">
<h4>Next Steps</h4>
<p>Theoretically a clever individual could take this similarity information and explore related connections to join silos of related academic information.</p>
<p>It should also be possible to make larger inferences about the industry which the journal covers. To do this one could extract terms that are highly correlated with specific journals or combinations of journals. For example, Radiology journals have recently included the term “deep learning” in many top articles. The crossover of terms from ML to Radiology indicates the adoption of new technology. This has healthcare and business implications. It would be possible to extract these emerging terms over all of PubMed to discover changes and partnerships among industries. With the additional metadata it would also be possible to determine where these changes are occurring (by city, hospital, or university) and who is funding this research.</p>
<p></br></br></p>
</div>
<div id="the-works-cited-from-my-paper" class="section level3">
<h3>The works cited from my paper</h3>
<p>Some of these sources were noted and linked directly in this page, other sources contributed to ideas and understanding.</p>
<pre><code>Allen, E. A., Erhardt, E. B.,  Calhoun, V. D. (2012). Data Visualization in the Neurosciences: Overcoming the Curse of Dimensionality. Neuron, 74(4), 603–608. https://doi.org/10.1016/j.neuron.2012.05.001
Altınel, B., Can Ganiz, M.,  Diri, B. (2015). A corpus-based semantic kernel for text classification by using meaning values of terms. Engineering Applications of Artificial Intelligence, 43, 54–66. https://doi.org/10.1016/j.engappai.2015.03.015
amoeba. (2016, October 4). What’s the formula for the Benjamini-Hochberg adjusted p-value? [Forum Comment]. Cross Validated. https://stats.stackexchange.com/questions/238458/whats-the-formula-for-the-benjamini-hochberg-adjusted-p-value/402217
Anscombe, F. J. (1973). Graphs in Statistical Analysis. The American Statistician, 27(1), 17. https://doi.org/10.2307/2682899
Benjamini, Y., Heller, R.,  Yekutieli, D. (2009). Selective inference in complex research. Philosophical Transactions of the Royal Society A: Mathematical, Physical and Engineering Sciences, 367(1906), 4255–4271. https://doi.org/10.1098/rsta.2009.0127
Benjamini, Y.,  Hochberg, Y. (1995). Controlling the False Discovery Rate: A Practical and Powerful Approach to Multiple Testing. Journal of the Royal Statistical Society: Series B (Methodological), 57(1), 289–300. https://doi.org/10.1111/j.2517-6161.1995.tb02031.x
Databricks. (n.d.). Databricks spark-xml. GitHub. https://github.com/databricks/spark-xml
Doan, S., Yang, E. W., Tilak, S. S., Li, P. W., Zisook, D. S.,  Torii, M. (2019). Extracting health-related causality from twitter messages using natural language processing. BMC Medical Informatics and Decision Making, 19(S3), 19. https://doi.org/10.1186/s12911-019-0785-0
Felizardo, K. R., MacDonell, S. G., Mendes, E.,  Maldonado, J. C. (2012). A Systematic Mapping on the use of Visual Data Mining to Support the Conduct of Systematic Literature Reviews. Journal of Software, 7(2), 1. https://doi.org/10.4304/jsw.7.2.450-461
HARRELL, F. R. A. N. K. E.,  DAVIS, C. E. (1982). A new distribution-free quantile estimator. Biometrika, 69(3), 635–640. https://doi.org/10.1093/biomet/69.3.635
Kurland, O.,  Lee, L. (2009). Clusters, language models, and ad hoc information retrieval. ACM Transactions on Information Systems, 27(3), 1–39. https://doi.org/10.1145/1508850.1508851
Luhn, H. P. (1957). A Statistical Approach to Mechanized Encoding and Searching of Literary Information. IBM Journal of Research and Development, 1(4), 309–317. https://doi.org/10.1147/rd.14.0309
Mair, P.,  Wilcox, R. (2019). Robust statistical methods in R using the WRS2 package. Behavior Research Methods, 52(2), 464–488. https://doi.org/10.3758/s13428-019-01246-w
Manning, C. D., Raghavan, P.,  Schütze, H. (2008). Introduction to Information Retrieval [E-book]. Cambridge University Press. https://www-nlp.stanford.edu/IR-book/
Manning, C., Surdeanu, M., Bauer, J., Finkel, J., Bethard, S.,  McClosky, D. (2014). The Stanford CoreNLP Natural Language Processing Toolkit. Stanford. https://nlp.stanford.edu/pubs/StanfordCoreNlp2014.pdf
Pennington, J., Socher, R.,  Manning, C. (2014). Glove: Global Vectors for Word Representation. Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (EMNLP), 1. https://doi.org/10.3115/v1/d14-1162
Rousselet, G. A., Pernet, C. R.,  Wilcox, R. R. (2017). Beyond differences in means: robust graphical methods to compare two groups in neuroscience. European Journal of Neuroscience, 46(2), 1738–1748. https://doi.org/10.1111/ejn.13610
Salton, G.,  Buckley, C. (1988). Term-weighting approaches in automatic text retrieval. Information Processing  Management, 24(5), 513–523. https://doi.org/10.1016/0306-4573(88)90021-0
Singhal, A. S. (2001). Modern Information Retrieval: A Brief Overview. IEEE. http://singhal.info/ieee2001.pdf
Smyth, G. S. gordon-smyth. (2012, January 1). Bioconductor Forum. Bioconductor Forum. https://support.bioconductor.org/p/49864/
SPARCK JONES, K. A. R. E. N. (1972). A STATISTICAL INTERPRETATION OF TERM SPECIFICITY AND ITS APPLICATION IN RETRIEVAL. Journal of Documentation, 28(1), 11–21. https://doi.org/10.1108/eb026526
Wilcox, R. R. (2001). Modern Insights About Pearson’s Correlation and Least Squares Regression. International Journal of Selection and Assessment, 9(1  2), 195–205. https://doi.org/10.1111/1468-2389.00172
Wu, H. C., Luk, R. W. P., Wong, K. F.,  Kwok, K. L. (2008). Interpreting TF-IDF term weights as making relevance decisions. ACM Transactions on Information Systems, 26(3), 1–37. https://doi.org/10.1145/1361684.1361686
Yekutieli, D.,  Benjamini, Y. (1999). Resampling-based false discovery rate controlling multiple test procedures for correlated test statistics. Journal of Statistical Planning and Inference, 82(1–2), 171–196. https://doi.org/10.1016/s0378-3758(99)00041-5
Zaharia, M., Xin, R. S., Wendell, P., Das, T., Armbrust, M., Dave, A., Meng, X., Rosen, J., Venkataraman, S., Franklin, M. J., Ghodsi, A., Gonzalez, J., Shenker, S.,  Stoica, I. (2016). Apache Spark. Communications of the ACM, 59(11), 56–65. https://doi.org/10.1145/2934664</code></pre>
</div>
</div>
</div>
